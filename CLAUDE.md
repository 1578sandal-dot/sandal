# CLAUDE.md

이 파일은 Claude Code (claude.ai/code)가 이 저장소의 코드 작업 시 참조할 수 있는 가이드를 제공합니다.

## 프로젝트 개요

Google 캘린더 이벤트를 Google 시트와 동기화하여 주문/작업량 관리를 자동화하는 Google Apps Script 애플리케이션입니다. 이 시스템은 제품 주문 정보가 포함된 캘린더 이벤트를 처리하고 한국어를 지원하는 구조화된 스프레드시트 데이터를 유지합니다.

## 필수 명령어

### Google Apps Script CLI (clasp)
```bash
# Google Apps Script에 코드 배포/업데이트
clasp push

# Apps Script에서 최신 코드 다운로드
clasp pull

# 프로젝트 상태 확인
clasp status

# Apps Script 편집기에서 프로젝트 열기
clasp open
```

### 사전 준비사항
- Google Apps Script API가 활성화되어 있어야 함: https://script.google.com/home/usersettings
- `clasp login`을 통해 로그인되어 있어야 함

## 핵심 아키텍처

### 데이터 플로우 파이프라인
```
캘린더 이벤트 → HTML 파싱 → 데이터 추출 → 시트 작성 → 데이터 보호
```

### 주요 구성 요소

1. **설정 시스템** (`CONFIG` 객체)
   - 폴더 구조, 캘린더 ID, 동기화 매개변수 제어
   - 쉬운 유지보수를 위한 중앙화된 설정

2. **이벤트 처리 엔진**
   - `캘린더동기화()`: 주요 동기화 함수
   - `processMonth()`: 월별 일괄 처리
   - `processEvent()`: 개별 이벤트 파싱 및 처리

3. **데이터 보호 레이어**
   - 보호 플래그("이동됨", "삭제됨")를 사용하여 이동된 데이터 덮어쓰기 방지
   - G열의 "당일" 트리거를 통한 수동 오버라이드 시스템
   - 동기화 전반에 걸친 데이터 무결성 유지

4. **HTML 파서**
   - `parseEventDescription()`: 캘린더 이벤트 HTML에서 제품 정보 추출
   - 다양한 형식과 누락된 데이터를 우아하게 처리

### 스프레드시트 데이터 구조
- **B열**: 주문 정보/메모
- **C-D열**: 제품명과 수량
- **F열**: 보호 플래그
- **G열**: 수동 이동 트리거
- **H열**: 추적용 이벤트 ID

## 개발 패턴

### 오류 처리
- API 호출 주변의 포괄적인 try-catch 블록
- 누락되거나 잘못된 데이터에 대한 우아한 대체 방안
- 디버깅을 위한 콘솔 로깅

### 코드 구조
- 주석 섹션과 함께 논리적 목적별로 그룹화된 함수
- 데이터 처리와 UI 작업 간의 명확한 분리
- 일관된 한국어/영어 명명 규칙

### 비즈니스 로직 보호
- 보호 플래그를 존중하는 스마트 데이터 클리어링
- 수동으로 이동된 데이터를 위한 백업 메커니즘
- 파괴적 작업 전 유효성 검사

## 주요 설정 포인트

### 캘린더 통합
- 기본 캘린더: "primary" (사용자의 주 캘린더)
- 동기화 기간: 1개월 (`MONTHS_TO_SYNC`)
- 한국 시간대: "Asia/Seoul"

### 스프레드시트 레이아웃
- 데이터 시작 행: 130행 (`DATA_START_ROW`)
- 이벤트 간격: 이벤트 간 6행 (`EVENT_SPACING`)
- `WEEKDAYS` 배열의 한국어 요일명

## 수동 오버라이드 시스템

사용자가 주문을 수동으로 이동하는 방법:
1. G열에 "당일" 입력
2. 시스템이 자동으로 주문을 다음 날로 이동
3. 원본 데이터는 향후 동기화에서 보호됨
4. 이벤트 ID를 통한 감사 추적 유지

## 테스트 및 디버깅

Google Apps Script이므로:
- Apps Script 편집기에서 직접 함수 테스트
- 디버깅을 위해 `console.log()` 사용 (Apps Script 콘솔에서 확인)
- 먼저 작은 날짜 범위로 테스트
- 전체 배포 전에 데이터 보호 메커니즘 확인

## 중요 사항

- 보호 플래그("이동됨", "삭제됨")를 프로그래밍 방식으로 수정하지 말 것
- 한국 비즈니스 컨텍스트와 언어 요구사항 준수
- 시간대 일관성 유지(Asia/Seoul)
- 데이터 무결성을 위한 이벤트 ID 추적 보존
- HTML 파싱 실패를 우아하게 처리